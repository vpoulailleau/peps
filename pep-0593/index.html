
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <title>PEP 593 – Flexible function and variable annotations | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png"/>
    <link rel="canonical" href="https://peps.python.org/pep-0593.html" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/mq.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="css-dark"/>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg" />
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)"/>
</head>
<body>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 593 – Flexible function and variable annotations</li>
            </ul>
            <button aria-label="Toggle dark mode" onClick="toggleColourScheme()"></button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 593 – Flexible function and variable annotations</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd">593</dd>
<dt class="field-even">Title</dt>
<dd class="field-even">Flexible function and variable annotations</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd">Till Varoquaux &lt;till&#32;&#97;t&#32;fb.com&gt;, Konstantin Kashin &lt;kkashin&#32;&#97;t&#32;fb.com&gt;</dd>
<dt class="field-even">Sponsor</dt>
<dd class="field-even">Ivan Levkivskyi &lt;levkivskyi&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-odd">Discussions-To</dt>
<dd class="field-odd"><a class="reference external" href="mailto:typing-sig&#37;&#52;&#48;python&#46;org">typing-sig<span>&#64;</span>python<span>&#46;</span>org</a></dd>
<dt class="field-even">Status</dt>
<dd class="field-even">Accepted</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd">Standards Track</dd>
<dt class="field-even">Created</dt>
<dd class="field-even">26-Apr-2019</dd>
<dt class="field-odd">Python-Version</dt>
<dd class="field-odd">3.9</dd>
<dt class="field-even">Post-History</dt>
<dd class="field-even">20-May-2019</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#motivating-examples">Motivating examples</a><ul>
<li><a class="reference internal" href="#combining-runtime-and-static-uses-of-annotations">Combining runtime and static uses of annotations</a></li>
<li><a class="reference internal" href="#lowering-barriers-to-developing-new-typing-constructs">Lowering barriers to developing new typing constructs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#consuming-annotations">Consuming annotations</a></li>
<li><a class="reference internal" href="#interaction-with-get-type-hints">Interaction with <code class="docutils literal notranslate"><span class="pre">get_type_hints()</span></code></a></li>
<li><a class="reference internal" href="#aliases-concerns-over-verbosity">Aliases &amp; Concerns over verbosity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rejected-ideas">Rejected ideas</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract">Abstract</a></h2>
<p>This PEP introduces a mechanism to extend the type annotations from PEP
484 with arbitrary metadata.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation">Motivation</a></h2>
<p><a class="pep reference internal" href="../pep-0484" title="PEP 484 – Type Hints">PEP 484</a> provides a standard semantic for the annotations introduced in
<a class="pep reference internal" href="../pep-3107" title="PEP 3107 – Function Annotations">PEP 3107</a>. <a class="pep reference internal" href="../pep-0484" title="PEP 484 – Type Hints">PEP 484</a> is prescriptive but it is the de facto standard
for most of the consumers of annotations; in many statically checked
code bases, where type annotations are widely used, they have
effectively crowded out any other form of annotation. Some of the use
cases for annotations described in <a class="pep reference internal" href="../pep-3107" title="PEP 3107 – Function Annotations">PEP 3107</a> (database mapping,
foreign languages bridge) are not currently realistic given the
prevalence of type annotations. Furthermore, the standardisation of type
annotations rules out advanced features only supported by specific type
checkers.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale">Rationale</a></h2>
<p>This PEP adds an <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type to the typing module to decorate
existing types with context-specific metadata. Specifically, a type
<code class="docutils literal notranslate"><span class="pre">T</span></code> can be annotated with metadata <code class="docutils literal notranslate"><span class="pre">x</span></code> via the typehint
<code class="docutils literal notranslate"><span class="pre">Annotated[T,</span> <span class="pre">x]</span></code>. This metadata can be used for either static
analysis or at runtime. If a library (or tool) encounters a typehint
<code class="docutils literal notranslate"><span class="pre">Annotated[T,</span> <span class="pre">x]</span></code> and has no special logic for metadata <code class="docutils literal notranslate"><span class="pre">x</span></code>, it
should ignore it and simply treat the type as <code class="docutils literal notranslate"><span class="pre">T</span></code>. Unlike the
<code class="docutils literal notranslate"><span class="pre">no_type_check</span></code> functionality that currently exists in the <code class="docutils literal notranslate"><span class="pre">typing</span></code>
module which completely disables typechecking annotations on a function
or a class, the <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type allows for both static typechecking
of <code class="docutils literal notranslate"><span class="pre">T</span></code> (e.g., via mypy <a class="reference internal" href="../pep-0484/#mypy" id="id1"><span>[mypy]</span></a> or Pyre <a class="reference internal" href="#pyre" id="id2"><span>[pyre]</span></a>, which can safely ignore <code class="docutils literal notranslate"><span class="pre">x</span></code>)
together with runtime access to <code class="docutils literal notranslate"><span class="pre">x</span></code> within a specific application. The
introduction of this type would address a diverse set of use cases of interest
to the broader Python community.</p>
<p>This was originally brought up as issue 600 <a class="reference internal" href="#issue-600" id="id3"><span>[issue-600]</span></a> in the typing github
and then discussed in Python ideas <a class="reference internal" href="#python-ideas" id="id4"><span>[python-ideas]</span></a>.</p>
</section>
<section id="motivating-examples">
<h2><a class="toc-backref" href="#motivating-examples">Motivating examples</a></h2>
<section id="combining-runtime-and-static-uses-of-annotations">
<h3><a class="toc-backref" href="#combining-runtime-and-static-uses-of-annotations">Combining runtime and static uses of annotations</a></h3>
<p>There’s an emerging trend of libraries leveraging the typing annotations at
runtime (e.g.: dataclasses); having the ability to extend the typing annotations
with external data would be a great boon for those libraries.</p>
<p>Here’s an example of how a hypothetical module could leverage annotations to
read c structs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UnsignedShort</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">struct2</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)]</span>
<span class="n">SignedChar</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">struct2</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">struct2</span><span class="o">.</span><span class="n">Packed</span><span class="p">):</span>
    <span class="c1"># mypy typechecks &#39;name&#39; field as &#39;str&#39;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">struct2</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;&lt;10s&quot;</span><span class="p">)]</span>
    <span class="n">serialnum</span><span class="p">:</span> <span class="n">UnsignedShort</span>
    <span class="n">school</span><span class="p">:</span> <span class="n">SignedChar</span>

<span class="c1"># &#39;unpack&#39; only uses the metadata within the type annotations</span>
<span class="n">Student</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>
<span class="c1"># Student(name=b&#39;raymond   &#39;, serialnum=4658, school=264)</span>
</pre></div>
</div>
</section>
<section id="lowering-barriers-to-developing-new-typing-constructs">
<h3><a class="toc-backref" href="#lowering-barriers-to-developing-new-typing-constructs">Lowering barriers to developing new typing constructs</a></h3>
<p>Typically when adding a new type, a developer need to upstream that type to the
typing module and change mypy, PyCharm <a class="reference internal" href="../pep-0482/#id17" id="id5"><span>[pycharm]</span></a>, Pyre, pytype <a class="reference internal" href="#pytype" id="id6"><span>[pytype]</span></a>,
etc…
This is particularly important when working on open-source code that
makes use of these types, seeing as the code would not be immediately
transportable to other developers’ tools without additional logic. As a result,
there is a high cost to developing and trying out new types in a codebase.
Ideally, authors should be able to introduce new types in a manner that allows
for graceful degradation (e.g.: when clients do not have a custom mypy plugin
<a class="reference internal" href="#mypy-plugin" id="id7"><span>[mypy-plugin]</span></a>), which would lower the barrier to development and ensure some
degree of backward compatibility.</p>
<p>For example, suppose that an author wanted to add support for tagged unions
<a class="reference internal" href="#tagged-union" id="id8"><span>[tagged-union]</span></a> to Python. One way to accomplish would be to annotate
<code class="docutils literal notranslate"><span class="pre">TypedDict</span></code> <a class="reference internal" href="#typed-dict" id="id9"><span>[typed-dict]</span></a> in Python such that only one field is allowed to be
set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Currency</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="n">TypedDict</span><span class="p">(</span><span class="s1">&#39;Currency&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;dollars&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="s1">&#39;pounds&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">},</span> <span class="n">total</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">TaggedUnion</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This is a somewhat cumbersome syntax but it allows us to iterate on this
proof-of-concept and have people with type checkers (or other tools) that don’t
yet support this feature work in a codebase with tagged unions. The author could
easily test this proposal and iron out the kinks before trying to upstream tagged
union to <code class="docutils literal notranslate"><span class="pre">typing</span></code>, mypy, etc. Moreover, tools that do not have support for
parsing the <code class="docutils literal notranslate"><span class="pre">TaggedUnion</span></code> annotation would still be able to treat <code class="docutils literal notranslate"><span class="pre">Currency</span></code>
as a <code class="docutils literal notranslate"><span class="pre">TypedDict</span></code>, which is still a close approximation (slightly less strict).</p>
</section>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification">Specification</a></h2>
<section id="syntax">
<h3><a class="toc-backref" href="#syntax">Syntax</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> is parameterized with a type and an arbitrary list of
Python values that represent the annotations. Here are the specific
details of the syntax:</p>
<ul>
<li>The first argument to <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> must be a valid type</li>
<li>Multiple type annotations are supported (<code class="docutils literal notranslate"><span class="pre">Annotated</span></code> supports variadic
arguments):<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> must be called with at least two arguments (
<code class="docutils literal notranslate"><span class="pre">Annotated[int]</span></code> is not valid)</li>
<li>The order of the annotations is preserved and matters for equality
checks:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">),</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li>Nested <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> types are flattened, with metadata ordered
starting with the innermost annotation:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)]</span> <span class="o">==</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;char&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li>Duplicated annotations are not removed:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ValueRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> can be used with nested and generic aliases:<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Typevar</span> <span class="n">T</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">Vec</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">]],</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">Vec</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>

<span class="n">V</span> <span class="o">==</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">MaxLen</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="consuming-annotations">
<h3><a class="toc-backref" href="#consuming-annotations">Consuming annotations</a></h3>
<p>Ultimately, the responsibility of how to interpret the annotations (if
at all) is the responsibility of the tool or library encountering the
<code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type. A tool or library encountering an <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type
can scan through the annotations to determine if they are of interest
(e.g., using <code class="docutils literal notranslate"><span class="pre">isinstance()</span></code>).</p>
<p><strong>Unknown annotations:</strong> When a tool or a library does not support
annotations or encounters an unknown annotation it should just ignore it
and treat annotated type as the underlying type. For example, when encountering
an annotation that is not an instance of <code class="docutils literal notranslate"><span class="pre">struct2.ctype</span></code> to the annotations
for name (e.g., <code class="docutils literal notranslate"><span class="pre">Annotated[str,</span> <span class="pre">'foo',</span> <span class="pre">struct2.ctype(&quot;&lt;10s&quot;)]</span></code>), the unpack
method should ignore it.</p>
<p><strong>Namespacing annotations:</strong> Namespaces are not needed for annotations since
the class used by the annotations acts as a namespace.</p>
<p><strong>Multiple annotations:</strong> It’s up to the tool consuming the annotations
to decide whether the client is allowed to have several annotations on
one type and how to merge those annotations.</p>
<p>Since the <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> type allows you to put several annotations of
the same (or different) type(s) on any node, the tools or libraries
consuming those annotations are in charge of dealing with potential
duplicates. For example, if you are doing value range analysis you might
allow this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T1</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
<span class="n">T2</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T1</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
<p>Flattening nested annotations, this translates to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T2</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ValueRange</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</section>
<section id="interaction-with-get-type-hints">
<h3><a class="toc-backref" href="#interaction-with-get-type-hints">Interaction with <code class="docutils literal notranslate"><span class="pre">get_type_hints()</span></code></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">typing.get_type_hints()</span></code> will take a new argument <code class="docutils literal notranslate"><span class="pre">include_extras</span></code> that
defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code> to preserve backward compatibility. When
<code class="docutils literal notranslate"><span class="pre">include_extras</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, the extra annotations will be stripped
out of the returned value. Otherwise, the annotations will be returned
unchanged:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@struct2</span><span class="o">.</span><span class="n">packed</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;&lt;10s&quot;</span><span class="p">)]</span>

<span class="n">get_type_hints</span><span class="p">(</span><span class="n">Student</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
<span class="n">get_type_hints</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span> <span class="n">include_extras</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">}</span>
<span class="n">get_type_hints</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span> <span class="n">include_extras</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">ctype</span><span class="p">(</span><span class="s2">&quot;&lt;10s&quot;</span><span class="p">)]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="aliases-concerns-over-verbosity">
<h3><a class="toc-backref" href="#aliases-concerns-over-verbosity">Aliases &amp; Concerns over verbosity</a></h3>
<p>Writing <code class="docutils literal notranslate"><span class="pre">typing.Annotated</span></code> everywhere can be quite verbose;
fortunately, the ability to alias annotations means that in practice we
don’t expect clients to have to write lots of boilerplate code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
<span class="n">Const</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">my_annotations</span><span class="o">.</span><span class="n">CONST</span><span class="p">]</span>

<span class="n">Class</span> <span class="n">C</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">const_method</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">Const</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas">Rejected ideas</a></h2>
<p>Some of the proposed ideas were rejected from this PEP because they would
cause <code class="docutils literal notranslate"><span class="pre">Annotated</span></code> to not integrate cleanly with the other typing annotations:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> cannot infer the decorated type. You could imagine that
<code class="docutils literal notranslate"><span class="pre">Annotated[...,</span> <span class="pre">Immutable]</span></code> could be used to mark a value as immutable
while still inferring its type. Typing does not support using the
inferred type anywhere else <a class="reference internal" href="#issue-276" id="id10"><span>[issue-276]</span></a>; it’s best to not add this as a
special case.</li>
<li>Using <code class="docutils literal notranslate"><span class="pre">(Type,</span> <span class="pre">Ann1,</span> <span class="pre">Ann2,</span> <span class="pre">...)</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">Annotated[Type,</span> <span class="pre">Ann1,</span> <span class="pre">Ann2,</span> <span class="pre">...]</span></code>. This would cause confusion when
annotations appear in nested positions (<code class="docutils literal notranslate"><span class="pre">Callable[[A,</span> <span class="pre">B],</span> <span class="pre">C]</span></code> is too similar
to <code class="docutils literal notranslate"><span class="pre">Callable[[(A,</span> <span class="pre">B)],</span> <span class="pre">C]</span></code>) and would make it impossible for constructors to
be passthrough (<code class="docutils literal notranslate"><span class="pre">T(5)</span> <span class="pre">==</span> <span class="pre">C(5)</span></code> when <code class="docutils literal notranslate"><span class="pre">C</span> <span class="pre">=</span> <span class="pre">Annotation[T,</span> <span class="pre">Ann]</span></code>).</li>
</ul>
<p>This feature was left out to keep the design simple:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Annotated</span></code> cannot be called with a single argument. Annotated could support
returning the underlying value when called with a single argument (e.g.:
<code class="docutils literal notranslate"><span class="pre">Annotated[int]</span> <span class="pre">==</span> <span class="pre">int</span></code>). This complicates the specifications and adds
little benefit.</li>
</ul>
</section>
<section id="references">
<h2><a class="toc-backref" href="#references">References</a></h2>
<dl class="citation">
<dt class="label" id="issue-600">[<a href="#id3">issue-600</a>]</dt>
<dd><a class="reference external" href="https://github.com/python/typing/issues/600">https://github.com/python/typing/issues/600</a></dd>
<dt class="label" id="python-ideas">[<a href="#id4">python-ideas</a>]</dt>
<dd><a class="reference external" href="https://mail.python.org/pipermail/python-ideas/2019-January/054908.html">https://mail.python.org/pipermail/python-ideas/2019-January/054908.html</a></dd>
<dt class="label" id="struct-doc">[struct-doc]</dt>
<dd><a class="reference external" href="https://docs.python.org/3/library/struct.html#examples">https://docs.python.org/3/library/struct.html#examples</a></dd>
<dt class="label" id="mypy">[<a href="#id1">mypy</a>]</dt>
<dd><a class="reference external" href="http://www.mypy-lang.org/">http://www.mypy-lang.org/</a></dd>
<dt class="label" id="pyre">[<a href="#id2">pyre</a>]</dt>
<dd><a class="reference external" href="https://pyre-check.org/">https://pyre-check.org/</a></dd>
<dt class="label" id="pycharm">[<a href="#id5">pycharm</a>]</dt>
<dd><a class="reference external" href="https://www.jetbrains.com/pycharm/">https://www.jetbrains.com/pycharm/</a></dd>
<dt class="label" id="pytype">[<a href="#id6">pytype</a>]</dt>
<dd><a class="reference external" href="https://github.com/google/pytype">https://github.com/google/pytype</a></dd>
<dt class="label" id="mypy-plugin">[<a href="#id7">mypy-plugin</a>]</dt>
<dd><a class="reference external" href="https://github.com/python/mypy_extensions">https://github.com/python/mypy_extensions</a></dd>
<dt class="label" id="tagged-union">[<a href="#id8">tagged-union</a>]</dt>
<dd><a class="reference external" href="https://en.wikipedia.org/wiki/Tagged_union">https://en.wikipedia.org/wiki/Tagged_union</a></dd>
<dt class="label" id="typed-dict">[<a href="#id9">typed-dict</a>]</dt>
<dd><a class="reference external" href="https://mypy.readthedocs.io/en/latest/more_types.html#typeddict">https://mypy.readthedocs.io/en/latest/more_types.html#typeddict</a></dd>
<dt class="label" id="issue-276">[<a href="#id10">issue-276</a>]</dt>
<dd><a class="reference external" href="https://github.com/python/typing/issues/276">https://github.com/python/typing/issues/276</a></dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/pep-0593.rst">https://github.com/python/peps/blob/main/pep-0593.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/pep-0593.rst">2022-01-21 11:03:51 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <p id="toc-title">PEP 593 – Flexible function and variable annotations</p>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#motivating-examples">Motivating examples</a><ul>
<li><a class="reference internal" href="#combining-runtime-and-static-uses-of-annotations">Combining runtime and static uses of annotations</a></li>
<li><a class="reference internal" href="#lowering-barriers-to-developing-new-typing-constructs">Lowering barriers to developing new typing constructs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specification">Specification</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#consuming-annotations">Consuming annotations</a></li>
<li><a class="reference internal" href="#interaction-with-get-type-hints">Interaction with <code class="docutils literal notranslate"><span class="pre">get_type_hints()</span></code></a></li>
<li><a class="reference internal" href="#aliases-concerns-over-verbosity">Aliases &amp; Concerns over verbosity</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rejected-ideas">Rejected ideas</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br />
            <a id="source" href="https://github.com/python/peps/blob/main/pep-0593.rst">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
</body>
</html>