
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <title>PEP 645 – Allow writing optional types as x? | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png"/>
    <link rel="canonical" href="https://peps.python.org/pep-0645.html" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/mq.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="css-dark"/>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg" />
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)"/>
</head>
<body>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 645 – Allow writing optional types as x?</li>
            </ul>
            <button aria-label="Toggle dark mode" onClick="toggleColourScheme()"></button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 645 – Allow writing optional types as <code class="docutils literal notranslate"><span class="pre">x?</span></code></h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd">645</dd>
<dt class="field-even">Title</dt>
<dd class="field-even">Allow writing optional types as <code class="docutils literal notranslate"><span class="pre">x?</span></code></dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd">Maggie Moss &lt;maggiebmoss&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-even">Sponsor</dt>
<dd class="field-even">Guido van Rossum &lt;guido&#32;&#97;t&#32;python.org&gt;</dd>
<dt class="field-odd">Status</dt>
<dd class="field-odd">Draft</dd>
<dt class="field-even">Type</dt>
<dd class="field-even">Process</dd>
<dt class="field-odd">Created</dt>
<dd class="field-odd">25-Aug-2020</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract">Abstract</a></h2>
<p>This PEP proposes adding a <code class="docutils literal notranslate"><span class="pre">?</span></code> operator for types to allow writing <code class="docutils literal notranslate"><span class="pre">int?</span></code> in place of <code class="docutils literal notranslate"><span class="pre">Optional[int]</span></code>.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation">Motivation</a></h2>
<p>Types have become a valuable and powerful part of the Python language. However, many type annotations are verbose and add
considerable friction to using type annotations. By improving the typing syntax, adding types to Python code becomes simpler
and improves the development experience for Python users.</p>
<p>In a similar vein, a PEP to introduce short hand syntax for <a class="pep reference internal" href="../pep-0604" title="PEP 604 – Allow writing union types as X | Y">Union types</a> has
been approved and implemented.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale">Rationale</a></h2>
<p>Types in Python can be quite verbose, this can be a hindrance when working towards type adoption. Making types more ergonomic,
as was done with the Union type in <a class="pep reference internal" href="../pep-0604" title="PEP 604 – Allow writing union types as X | Y">PEP 604</a> (e.g., int | str), would reduce the effort needed to add types to new and existing Python code.
The Optional annotation is used frequently in both partially and fully typed Python code bases. In a small sampling of <a class="reference external" href="https://gist.github.com/MaggieMoss/fd8dfe002b2702fae243dbf81a62624e">5 well-typed open
source projects, on average 7% of annotations</a> [2] included at least one optional type. This indicates
that updating the syntax has the potential to make types more concise, reduce code length and improve readability.</p>
<p>Simplifying the syntax for optionals has been <a class="reference external" href="https://github.com/python/typing/issues/429">discussed previously</a> [3] within the typing community.
The consensus during these conversations has been that <code class="docutils literal notranslate"><span class="pre">?</span></code> is the preferred operator. There is no native support for unary <code class="docutils literal notranslate"><span class="pre">?</span></code> in Python and this will
need to be added to the runtime.</p>
<p>Adding the ? sigil to the Python grammar has been proposed previously in <a class="pep reference internal" href="../pep-0505" title="PEP 505 – None-aware operators">PEP 505</a>, which is currently in a deferred state.
<a class="pep reference internal" href="../pep-0505" title="PEP 505 – None-aware operators">PEP 505</a> proposes a:</p>
<blockquote>
<div><ul class="simple">
<li>“None coalescing” binary operator <code class="docutils literal notranslate"><span class="pre">??</span></code></li>
<li>“None-aware attribute access” operator <code class="docutils literal notranslate"><span class="pre">?.</span></code> (“maybe dot”)</li>
<li>“None-aware indexing” operator <code class="docutils literal notranslate"><span class="pre">?[]</span></code> (“maybe subscript”)</li>
</ul>
</div></blockquote>
<p>Should <a class="pep reference internal" href="../pep-0505" title="PEP 505 – None-aware operators">PEP 505</a> be approved in the future, it would not interfere with the typing specific <code class="docutils literal notranslate"><span class="pre">?</span></code> proposed in this PEP. As well,
since all uses of the <code class="docutils literal notranslate"><span class="pre">?</span></code> would be conceptually related, it would not be confusing in terms of learning Python or a hindrance to quick visual comprehension.</p>
<p>The proposed syntax, with the postfix operator, mimics the optional syntax found in other typed languages, like C#, TypeScript and Swift.
The widespread adoption and popularity of these languages means that Python developers are likely already familiar with this syntax.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Optional in Swift
var example: String?

// Optional in C#
string? example;
</pre></div>
</div>
<p>Adding this syntax would also follow the often used pattern of using builtin types as annotations. For example, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">dict</span></code> and <code class="docutils literal notranslate"><span class="pre">None</span></code>. This would allow more annotations to be
added to Python code without importing from <code class="docutils literal notranslate"><span class="pre">typing</span></code>.</p>
</section>
<section id="specification">
<h2><a class="toc-backref" href="#specification">Specification</a></h2>
<p>The new optional syntax should be accepted for function, variable, attribute and parameter annotations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># instead of
# def foo(x: Optional[int], y: Optional[str], z: Optional[list[int]): ...
def foo(x: int?, y: str?, x: list[int]?): ...

# def bar(x: list[typing.Optional[int]]): ...
def bar(x: list[int?]): ...
</pre></div>
</div>
<p>The new optional syntax should be equivalent to the existing typing.Optional syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>typing.Optional[int] == int?
</pre></div>
</div>
<p>The new optional syntax should have the same identity as the existing typing.Optional syntax.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>typing.Optional[int] is int?
</pre></div>
</div>
<p>It should also be equivalent to a Union with None.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># old syntax
int? == typing.Union[int, None]

# new syntax
int? == int | None
</pre></div>
</div>
<p>Since the new Union syntax specified in <a class="pep reference internal" href="../pep-0604" title="PEP 604 – Allow writing union types as X | Y">PEP 604</a> is supported in <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> and <code class="docutils literal notranslate"><span class="pre">issubclass</span></code>, the new optional syntax should be supported in both <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> and <code class="docutils literal notranslate"><span class="pre">issubclass</span></code>,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>isinstance(1, int?) # true
issubclass(Child, Super?) # true
</pre></div>
</div>
<p>A new dunder method will need to be implemented to allow the <code class="docutils literal notranslate"><span class="pre">?</span></code> operator to be overloaded for other functionality.</p>
</section>
<section id="backwards-compatibility">
<h2><a class="toc-backref" href="#backwards-compatibility">Backwards Compatibility</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">?</span></code> is currently unused in Python syntax, therefore this PEP is fully backwards compatible.</p>
</section>
<section id="reference-implementation">
<h2><a class="toc-backref" href="#reference-implementation">Reference Implementation</a></h2>
<p>A reference implementation can be found <a class="reference external" href="https://github.com/python/cpython/compare/master...MaggieMoss:new-optional-syntax-postfix">here</a> [5].</p>
</section>
<section id="rejected-ideas">
<h2><a class="toc-backref" href="#rejected-ideas">Rejected Ideas</a></h2>
<p>Discussed alternatives were</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">~</span></code> operator was considered in place of <code class="docutils literal notranslate"><span class="pre">?</span></code>.</li>
<li>A prefix operator (<code class="docutils literal notranslate"><span class="pre">?int</span></code>).</li>
</ul>
</section>
<section id="references">
<h2><a class="toc-backref" href="#references">References</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id1">[2]</dt>
<dd>Use of Optional Annotations in Open Source Python projects
(<a class="reference external" href="https://gist.github.com/MaggieMoss/fd8dfe002b2702fae243dbf81a62624e">https://gist.github.com/MaggieMoss/fd8dfe002b2702fae243dbf81a62624e</a>)</dd>
<dt class="label" id="id2">[3]</dt>
<dd>Github Issue Discussion of Optional syntax
(<a class="reference external" href="https://github.com/python/typing/issues/429">https://github.com/python/typing/issues/429</a>)</dd>
<dt class="label" id="id3">[5]</dt>
<dd>Reference Implementation
(<a class="reference external" href="https://github.com/python/cpython/compare/master...MaggieMoss:new-optional-syntax-postfix">https://github.com/python/cpython/compare/master…MaggieMoss:new-optional-syntax-postfix</a>)</dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright">Copyright</a></h2>
<p>This document is placed in the public domain or under the CC0-1.0-Universal license, whichever is more permissive.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/pep-0645.rst">https://github.com/python/peps/blob/main/pep-0645.rst</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/pep-0645.rst">2022-01-21 11:03:51 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <p id="toc-title">PEP 645 – Allow writing optional types as x?</p>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#specification">Specification</a></li>
<li><a class="reference internal" href="#backwards-compatibility">Backwards Compatibility</a></li>
<li><a class="reference internal" href="#reference-implementation">Reference Implementation</a></li>
<li><a class="reference internal" href="#rejected-ideas">Rejected Ideas</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br />
            <a id="source" href="https://github.com/python/peps/blob/main/pep-0645.rst">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
</body>
</html>