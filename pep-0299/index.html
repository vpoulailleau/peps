
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <title>PEP 299 – Special __main__() function in modules | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png"/>
    <link rel="canonical" href="https://peps.python.org/pep-0299.html" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/mq.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="css-dark"/>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg" />
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)"/>
</head>
<body>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 299 – Special __main__() function in modules</li>
            </ul>
            <button aria-label="Toggle dark mode" onClick="toggleColourScheme()"></button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 299 – Special __main__() function in modules</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd">299</dd>
<dt class="field-even">Title</dt>
<dd class="field-even">Special __main__() function in modules</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd">Jeff Epler &lt;jepler&#32;&#97;t&#32;unpythonic.net&gt;</dd>
<dt class="field-even">Status</dt>
<dd class="field-even">Rejected</dd>
<dt class="field-odd">Type</dt>
<dd class="field-odd">Standards Track</dd>
<dt class="field-even">Created</dt>
<dd class="field-even">12-Aug-2002</dd>
<dt class="field-odd">Python-Version</dt>
<dd class="field-odd">2.3</dd>
<dt class="field-even">Post-History</dt>
<dd class="field-even">29-Mar-2006</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Contents</summary><ul class="simple">
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#proposal">Proposal</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#open-issues">Open Issues</a></li>
<li><a class="reference internal" href="#rejection">Rejection</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract">Abstract</a></h2>
<p>Many Python modules are also intended to be callable as standalone
scripts.  This PEP proposes that a special function called <code class="docutils literal notranslate"><span class="pre">__main__()</span></code>
should serve this purpose.</p>
</section>
<section id="motivation">
<h2><a class="toc-backref" href="#motivation">Motivation</a></h2>
<p>There should be one simple and universal idiom for invoking a module
as a standalone script.</p>
<p>The semi-standard idiom:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">perform</span> <span class="s2">&quot;standalone&quot;</span> <span class="n">functionality</span>
</pre></div>
</div>
<p>is unclear to programmers of languages like C and C++.  It also does
not permit invocation of the standalone function when the module is
imported.  The variant:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main_function</span><span class="p">()</span>
</pre></div>
</div>
<p>is sometimes seen, but there exists no standard name for the function,
and because arguments are taken from sys.argv it is not possible to
pass specific arguments without changing the argument list seen by all
other modules.  (Imagine a threaded Python program, with two threads
wishing to invoke the standalone functionality of different modules
with different argument lists)</p>
</section>
<section id="proposal">
<h2><a class="toc-backref" href="#proposal">Proposal</a></h2>
<p>The standard name of the ‘main function’ should be <code class="docutils literal notranslate"><span class="pre">__main__</span></code>. When a
module is invoked on the command line, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">mymodule</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>then the module behaves as though the following lines existed at the
end of the module (except that the attribute __sys may not be used or
assumed to exist elsewhere in the script):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s2">&quot;__main__&quot;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">sys</span> <span class="k">as</span> <span class="nn">__sys</span>
    <span class="n">__sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">__main__</span><span class="p">(</span><span class="n">__sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
</pre></div>
</div>
<p>Other modules may execute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mymodule</span> <span class="n">mymodule</span><span class="o">.</span><span class="n">__main__</span><span class="p">([</span><span class="s1">&#39;mymodule&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>It is up to <code class="docutils literal notranslate"><span class="pre">mymodule</span></code> to document thread-safety issues or other
issues which might restrict use of <code class="docutils literal notranslate"><span class="pre">__main__</span></code>.  (Other issues might
include use of mutually exclusive GUI modules, non-sharable resources
like hardware devices, reassignment of <code class="docutils literal notranslate"><span class="pre">sys.stdin</span></code>/<code class="docutils literal notranslate"><span class="pre">stdout</span></code>, etc)</p>
</section>
<section id="implementation">
<h2><a class="toc-backref" href="#implementation">Implementation</a></h2>
<p>In <code class="docutils literal notranslate"><span class="pre">modules/main.c</span></code>, the block near line 385 (after the
<code class="docutils literal notranslate"><span class="pre">PyRun_AnyFileExFlags</span></code> call) will be changed so that the above code
(or its C equivalent) is executed.</p>
</section>
<section id="open-issues">
<h2><a class="toc-backref" href="#open-issues">Open Issues</a></h2>
<ul>
<li>Should the return value from <code class="docutils literal notranslate"><span class="pre">__main__</span></code> be treated as the exit value?<p>Yes.  Many <code class="docutils literal notranslate"><span class="pre">__main__</span></code> will naturally return <code class="docutils literal notranslate"><span class="pre">None</span></code>, which
<code class="docutils literal notranslate"><span class="pre">sys.exit</span></code> translates into a “success” return code.  In those that
return a numeric result, it behaves just like the argument to
<code class="docutils literal notranslate"><span class="pre">sys.exit()</span></code> or the return value from C’s main().</p>
</li>
<li>Should the argument list to <code class="docutils literal notranslate"><span class="pre">__main__</span></code> include <code class="docutils literal notranslate"><span class="pre">argv[0]</span></code>, or just the
“real” arguments <code class="docutils literal notranslate"><span class="pre">argv[1:]</span></code>?<p><code class="docutils literal notranslate"><span class="pre">argv[0]</span></code> is included for symmetry with <code class="docutils literal notranslate"><span class="pre">sys.argv</span></code> and easy
transition to the new standard idiom.</p>
</li>
</ul>
</section>
<section id="rejection">
<h2><a class="toc-backref" href="#rejection">Rejection</a></h2>
<p>In a short discussion on python-dev [1], two major backwards
compatibility problems were brought up and Guido pronounced that he
doesn’t like the idea anyway as it’s “not worth the change (in docs,
user habits, etc.) and there’s nothing particularly broken.”</p>
</section>
<section id="references">
<h2><a class="toc-backref" href="#references">References</a></h2>
<dl class="footnote brackets">
<dt class="label" id="id1">[1]</dt>
<dd>Georg Brandl, “What about PEP 299”,
<a class="reference external" href="https://mail.python.org/pipermail/python-dev/2006-March/062951.html">https://mail.python.org/pipermail/python-dev/2006-March/062951.html</a></dd>
</dl>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/pep-0299.txt">https://github.com/python/peps/blob/main/pep-0299.txt</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/pep-0299.txt">2017-11-11 19:28:55 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <p id="toc-title">PEP 299 – Special __main__() function in modules</p>
            <ul>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#proposal">Proposal</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
<li><a class="reference internal" href="#open-issues">Open Issues</a></li>
<li><a class="reference internal" href="#rejection">Rejection</a></li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br />
            <a id="source" href="https://github.com/python/peps/blob/main/pep-0299.txt">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
</body>
</html>