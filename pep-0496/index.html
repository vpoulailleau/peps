
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="color-scheme" content="light dark" />
    <title>PEP 496 – Environment Markers | peps.python.org</title>
    <link rel="shortcut icon" href="../_static/py.png"/>
    <link rel="canonical" href="https://peps.python.org/pep-0496.html" />
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/mq.css" type="text/css" />
    <link rel="stylesheet" href="../_static/dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="css-dark"/>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" media="(prefers-color-scheme: light)" id="pyg" />
    <link rel="stylesheet" href="../_static/pygments_dark.css" type="text/css" media="(prefers-color-scheme: dark)" id="pyg-dark" />
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <meta name="description" content="Python Enhancement Proposals (PEPs)"/>
</head>
<body>
    <section id="pep-page-section">
        <header>
            <h1>Python Enhancement Proposals</h1>
            <ul class="breadcrumbs">
                <li><a href="https://www.python.org/" title="The Python Programming Language">Python</a> &raquo; </li>
                <li><a href="../pep-0000/">PEP Index</a> &raquo; </li>
                <li>PEP 496 – Environment Markers</li>
            </ul>
            <button aria-label="Toggle dark mode" onClick="toggleColourScheme()"></button>
        </header>
        <article>
            <section id="pep-content">
<h1 class="page-title">PEP 496 – Environment Markers</h1>
<dl class="rfc2822 field-list simple">
<dt class="field-odd">PEP</dt>
<dd class="field-odd">496</dd>
<dt class="field-even">Title</dt>
<dd class="field-even">Environment Markers</dd>
<dt class="field-odd">Author</dt>
<dd class="field-odd">James Polley &lt;jp&#32;&#97;t&#32;jamezpolley.com&gt;</dd>
<dt class="field-even">BDFL-Delegate</dt>
<dd class="field-even">Nick Coghlan &lt;ncoghlan&#32;&#97;t&#32;gmail.com&gt;</dd>
<dt class="field-odd">Status</dt>
<dd class="field-odd">Rejected</dd>
<dt class="field-even">Type</dt>
<dd class="field-even">Informational</dd>
<dt class="field-odd">Created</dt>
<dd class="field-odd">03-Jul-2015</dd>
</dl>
<hr class="docutils" />
<section id="contents">
<details><summary>Contents</summary><ul class="simple">
<li><a class="reference internal" href="#pep-status">PEP Status</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#micro-language">Micro-language</a><ul>
<li><a class="reference internal" href="#strings">Strings</a></li>
<li><a class="reference internal" href="#version-numbers">Version numbers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>
</details></section>
<section id="pep-status">
<h2><a class="toc-backref" href="#pep-status">PEP Status</a></h2>
<p>After this PEP was initially drafted, <a class="pep reference internal" href="../pep-0508" title="PEP 508 – Dependency specification for Python Software Packages">PEP 508</a> was developed and submitted to
fully specify the dependency declaration syntax, including environment markers.
As a result, this PEP ended up being rejected in favour of the more comprehensive
<a class="pep reference internal" href="../pep-0508" title="PEP 508 – Dependency specification for Python Software Packages">PEP 508</a>.</p>
</section>
<section id="abstract">
<h2><a class="toc-backref" href="#abstract">Abstract</a></h2>
<p>An <strong>environment marker</strong> describes a condition about the current execution
environment. They are used to indicate when certain dependencies are only
required in particular environments, and to indicate supported platforms
for distributions with additional constraints beyond the availability of a
Python runtime.</p>
<p>Environment markers were first specified in <a class="pep reference internal" href="../pep-0345" title="PEP 345 – Metadata for Python Software Packages 1.2">PEP 345</a>. <a class="pep reference internal" href="../pep-0426" title="PEP 426 – Metadata for Python Software Packages 2.0">PEP 426</a>
(which would replace <a class="pep reference internal" href="../pep-0345" title="PEP 345 – Metadata for Python Software Packages 1.2">PEP 345</a>) proposed extensions to the markers.
When 2.7.10 was released, even these extensions became insufficient due to
their reliance on simple lexical comparisons, and thus this PEP has been born.</p>
</section>
<section id="rationale">
<h2><a class="toc-backref" href="#rationale">Rationale</a></h2>
<p>Many Python packages are written with portability in mind.</p>
<p>For many packages this means they aim to support a wide range of
Python releases. If they depend on libraries such as <code class="docutils literal notranslate"><span class="pre">argparse</span></code> -
which started as external libraries, but later got incorporated into
core - specifying a single set of requirements is difficult, as the
set of required packages differs depending on the version of Python in
use.</p>
<p>For other packages, designing for portability means supporting
multiple operating systems. However, the significant differences
between them may mean that particular dependencies are only needed on
particular platforms (relying on <code class="docutils literal notranslate"><span class="pre">pywin32</span></code> only on Windows, for
example)”</p>
<p>Environment Markers attempt to provide more flexibility in a list of
requirements by allowing the developer to list requirements that are
specific to a particular environment.</p>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#examples">Examples</a></h2>
<p>Here are some examples of such markers inside a requirements.txt:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pywin32</span> <span class="o">&gt;=</span><span class="mf">1.0</span> <span class="p">;</span> <span class="n">sys_platform</span> <span class="o">==</span> <span class="s1">&#39;win32&#39;</span>
<span class="n">unittest2</span> <span class="o">&gt;=</span><span class="mf">2.0</span><span class="p">,</span><span class="o">&lt;</span><span class="mf">3.0</span> <span class="p">;</span> <span class="n">python_version</span> <span class="o">==</span> <span class="s1">&#39;2.4&#39;</span> <span class="ow">or</span> <span class="n">python_version</span> <span class="o">==</span> <span class="s1">&#39;2.5&#39;</span>
<span class="n">backports</span><span class="o">.</span><span class="n">ssl_match_hostname</span> <span class="o">&gt;=</span> <span class="mf">3.4</span> <span class="p">;</span> <span class="n">python_version</span> <span class="o">&lt;</span> <span class="s1">&#39;2.7.9&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">python_version</span> <span class="o">&gt;=</span> <span class="s1">&#39;3.0&#39;</span> <span class="ow">and</span> <span class="n">python_version</span> <span class="o">&lt;</span> <span class="s1">&#39;3.4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And here’s an example of some conditional metadata included in
setup.py for a distribution that requires PyWin32 both at runtime and
buildtime when using Windows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
  <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pywin32 &gt; 1.0 : sys.platform == &#39;win32&#39;&quot;</span><span class="p">],</span>
  <span class="n">setup_requires</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pywin32 &gt; 1.0 : sys.platform == &#39;win32&#39;&quot;</span><span class="p">]</span>
  <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="micro-language">
<h2><a class="toc-backref" href="#micro-language">Micro-language</a></h2>
<p>The micro-language behind this is as follows. It compares:</p>
<ul class="simple">
<li>strings with the <code class="docutils literal notranslate"><span class="pre">==</span></code> and <code class="docutils literal notranslate"><span class="pre">in</span></code> operators (and their opposites)</li>
<li>version numbers with the <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, and <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> operators
in addition to those supported for strings</li>
</ul>
<p>The usual boolean operators <code class="docutils literal notranslate"><span class="pre">and</span></code> and <code class="docutils literal notranslate"><span class="pre">or</span></code> can be used to combine
expressions, and parentheses are supported for grouping.</p>
<p>The pseudo-grammar is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MARKER</span><span class="p">:</span> <span class="n">EXPR</span> <span class="p">[(</span><span class="ow">and</span><span class="o">|</span><span class="ow">or</span><span class="p">)</span> <span class="n">EXPR</span><span class="p">]</span><span class="o">*</span>
<span class="n">EXPR</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;(&quot;</span> <span class="n">MARKER</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">STREXPR</span><span class="o">|</span><span class="n">VEREXPR</span><span class="p">)</span>
<span class="n">STREXPR</span><span class="p">:</span> <span class="n">STRING</span> <span class="p">[</span><span class="n">STRCMPOP</span> <span class="n">STREXPR</span><span class="p">]</span>
<span class="n">STRCMPOP</span><span class="p">:</span> <span class="o">==|!=|</span><span class="ow">in</span><span class="o">|</span><span class="ow">not</span> <span class="ow">in</span>
<span class="n">VEREXPR</span><span class="p">:</span> <span class="n">VERSION</span> <span class="p">[</span><span class="n">VERCMPOP</span> <span class="n">VEREXPR</span><span class="p">]</span>
<span class="n">VERCMPOP</span><span class="p">:</span> <span class="p">(</span><span class="o">==|!=|&lt;|&gt;|&lt;=|&gt;=</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SUBEXPR</span></code> is either a Python string (such as <code class="docutils literal notranslate"><span class="pre">'win32'</span></code>) or one of
the <code class="docutils literal notranslate"><span class="pre">Strings</span></code> marker variables listed below.</p>
<p><code class="docutils literal notranslate"><span class="pre">VEREXPR</span></code> is a <a class="pep reference internal" href="../pep-0440" title="PEP 440 – Version Identification and Dependency Specification">PEP 440</a> version identifier, or one of the
<code class="docutils literal notranslate"><span class="pre">Version</span> <span class="pre">number</span></code> marker variables listed below. Comparisons between
version numbers are done using <a class="pep reference internal" href="../pep-0440" title="PEP 440 – Version Identification and Dependency Specification">PEP 440</a> semantics.</p>
<section id="strings">
<h3><a class="toc-backref" href="#strings">Strings</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">os_name</span></code>: <code class="docutils literal notranslate"><span class="pre">os.name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">sys_platform</span></code>: <code class="docutils literal notranslate"><span class="pre">sys.platform</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">platform_release</span></code>: <code class="docutils literal notranslate"><span class="pre">platform.release()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">implementation_name</span></code>: <code class="docutils literal notranslate"><span class="pre">sys.implementation.name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">platform_machine</span></code>: <code class="docutils literal notranslate"><span class="pre">platform.machine()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">platform_python_implementation</span></code>: <code class="docutils literal notranslate"><span class="pre">platform.python_implementation()</span></code></li>
</ul>
<p>If a particular string value is not available (such as <code class="docutils literal notranslate"><span class="pre">sys.implementation.name</span></code>
in versions of Python prior to 3.3), the corresponding marker
variable MUST be considered equivalent to the empty string.</p>
<p>If a particular version number value is not available (such as
<code class="docutils literal notranslate"><span class="pre">sys.implementation.version</span></code> in versions of Python prior to 3.3) the
corresponding marker variable MUST be considered equivalent to <code class="docutils literal notranslate"><span class="pre">0</span></code></p>
</section>
<section id="version-numbers">
<h3><a class="toc-backref" href="#version-numbers">Version numbers</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">python_version</span></code>: <code class="docutils literal notranslate"><span class="pre">platform.python_version()[:3]</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">python_full_version</span></code>: see definition below</li>
<li><code class="docutils literal notranslate"><span class="pre">platform_version</span></code>: <code class="docutils literal notranslate"><span class="pre">platform.version()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">implementation_version</span></code>: see definition below</li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">python_full_version</span></code> and <code class="docutils literal notranslate"><span class="pre">implementation_version</span></code> marker variables
are derived from <code class="docutils literal notranslate"><span class="pre">sys.version_info</span></code> and <code class="docutils literal notranslate"><span class="pre">sys.implementation.version</span></code>
respectively, in accordance with the following algorithm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">format_full_version</span><span class="p">(</span><span class="n">info</span><span class="p">):</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0.major}</span><span class="s1">.</span><span class="si">{0.minor}</span><span class="s1">.</span><span class="si">{0.micro}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">releaselevel</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span>
        <span class="n">version</span> <span class="o">+=</span> <span class="n">kind</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">serial</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">version</span>

<span class="n">python_full_version</span> <span class="o">=</span> <span class="n">format_full_version</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">)</span>
<span class="n">implementation_version</span> <span class="o">=</span> <span class="n">format_full_version</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">implementation</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">python_full_version</span></code> will typically correspond to <code class="docutils literal notranslate"><span class="pre">sys.version.split()[0]</span></code>.</p>
</section>
</section>
<section id="copyright">
<h2><a class="toc-backref" href="#copyright">Copyright</a></h2>
<p>This document has been placed in the public domain.</p>
</section>
</section>
<hr class="docutils" />
<p>Source: <a class="reference external" href="https://github.com/python/peps/blob/main/pep-0496.txt">https://github.com/python/peps/blob/main/pep-0496.txt</a></p>
<p>Last modified: <a class="reference external" href="https://github.com/python/peps/commits/main/pep-0496.txt">2022-01-21 11:03:51 GMT</a></p>

        </article>
        <nav id="pep-sidebar">
            <h2>Contents</h2>
            <p id="toc-title">PEP 496 – Environment Markers</p>
            <ul>
<li><a class="reference internal" href="#pep-status">PEP Status</a></li>
<li><a class="reference internal" href="#abstract">Abstract</a></li>
<li><a class="reference internal" href="#rationale">Rationale</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
<li><a class="reference internal" href="#micro-language">Micro-language</a><ul>
<li><a class="reference internal" href="#strings">Strings</a></li>
<li><a class="reference internal" href="#version-numbers">Version numbers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#copyright">Copyright</a></li>
</ul>

            <br />
            <a id="source" href="https://github.com/python/peps/blob/main/pep-0496.txt">Page Source (GitHub)</a>
        </nav>
    </section>
    <script src="../_static/colour_scheme.js"></script>
    <script src="../_static/wrap_tables.js"></script>
</body>
</html>